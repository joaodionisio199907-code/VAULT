<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAULT | Official Store</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #050505;
            color: white;
            overflow-x: hidden;
        }

        :root {
            --v-green: #76ff03;
            --v-cyan: #00e5ff;
            --v-dark: #0d0d0d;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        .glass { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .card-v { background: #0d0d0d; border: 1px solid #1a1a1a; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-v:hover { border-color: var(--v-green); transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }

        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }

        .cat-item { transition: all 0.3s ease; }
        .cat-item:hover { background: #1a1a1a; border-color: rgba(255,255,255,0.2); }

        .btn-buy { background: var(--v-cyan); color: black; font-weight: 800; border-radius: 12px; transition: 0.3s; cursor: pointer; }
        .btn-buy:hover { background: white; transform: scale(1.05); box-shadow: 0 0 20px rgba(0,229,255,0.4); }

        #game-modal, #auth-modal { display: none; }
        #game-modal.active, #auth-modal.active { display: flex; }
        .no-scroll { overflow: hidden; }

        .lang-dropdown { display: none; position: absolute; top: 100%; right: 0; background: #0d0d0d; border: 1px solid #1a1a1a; border-radius: 12px; padding: 8px; min-width: 140px; z-index: 50; }
        .lang-dropdown.active { display: block; animation: fadeIn 0.2s ease; }

        /* NUEVO: ESTILO MENÚ USUARIO */
        .user-menu { display: none; position: absolute; top: 110%; right: 0; background: #0d0d0d; border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 8px; min-width: 160px; z-index: 100; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .user-menu.active { display: block; animation: fadeIn 0.2s ease; }

        /* LOADER */
        #vault-loader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity 0.6s ease; }
        .loader-content { text-align: center; }
        .loader-bar { width: 200px; height: 2px; background: rgba(255,255,255,0.1); margin-top: 20px; position: relative; overflow: hidden; }
        .loader-progress { position: absolute; height: 100%; width: 50%; background: var(--v-green); animation: slide 1s infinite linear; }
        
        @keyframes slide { from { left: -50%; } to { left: 100%; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="vault-loader">
    <div class="loader-content">
        <div class="bg-[#76ff03] p-4 rounded-2xl inline-block mb-4"><i data-lucide="shield" class="text-black w-8 h-8"></i></div>
        <div class="text-[10px] tracking-[5px] font-black uppercase text-white/50">Initializing Vault</div>
        <div class="loader-bar"><div class="loader-progress"></div></div>
    </div>
</div>

<nav class="fixed top-0 w-full z-[100] glass px-8 py-4">
    <div class="max-w-[1440px] mx-auto flex items-center justify-between">
        <div class="flex items-center gap-10">
            <div class="flex items-center gap-2 cursor-pointer group">
                <div class="bg-[#76ff03] p-1.5 rounded-lg group-hover:rotate-12 transition-transform"><i data-lucide="shield" class="text-black w-6 h-6"></i></div>
                <span class="text-2xl font-black italic tracking-tighter uppercase">VAULT</span>
            </div>
            <div class="hidden lg:flex gap-6 text-[10px] font-bold uppercase tracking-widest text-gray-400">
                <a href="#" class="text-white border-b-2 border-[#76ff03] pb-1" data-key="nav-store">Store</a>
                <a href="#" class="hover:text-white transition" data-key="nav-library">Library</a>
                <a href="#" class="hover:text-white transition" data-key="nav-community">Community</a>
                <a href="news.html" class="hover:text-white transition" data-key="nav-news">News</a>
                <a href="#" class="text-[#76ff03] animate-pulse" data-key="nav-offers">● Special Offers</a>
            </div>
        </div>
        <div class="flex-1 max-w-xl px-10">
            <div class="relative">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"></i>
                <input type="text" data-placeholder="search-placeholder" placeholder="Search games, tags, publishers..." class="w-full bg-white/5 border border-white/10 rounded-full py-2.5 pl-12 pr-4 text-xs focus:border-[#76ff03]/50 outline-none">
            </div>
        </div>
        <div class="flex items-center gap-6">
            <div class="relative">
                <button onclick="toggleLang('lang-top')" class="text-xs font-bold text-gray-400 hover:text-white flex items-center gap-1 uppercase">
                    <i data-lucide="languages" class="w-4 h-4"></i> <span class="current-lang">EN</span>
                </button>
                <div id="lang-top" class="lang-dropdown">
                    <button onclick="changeLanguage('en')" class="w-full text-left px-4 py-2 text-xs hover:bg-white/5 rounded-lg">English</button>
                    <button onclick="changeLanguage('es')" class="w-full text-left px-4 py-2 text-xs hover:bg-white/5 rounded-lg">Español</button>
                </div>
            </div>
            
            <div class="relative" id="user-wrapper">
                <button onclick="handleAuthClick()" id="auth-btn" class="bg-[#00e5ff] text-black text-[10px] font-extrabold px-6 py-2.5 rounded-full uppercase flex items-center gap-2">
                    Sign In
                </button>
                <div id="user-menu" class="user-menu">
                    <button onclick="window.location.href='perfil.html'" class="w-full text-left px-4 py-3 text-[10px] font-bold uppercase hover:bg-white/5 rounded-lg flex items-center gap-2">
    <i data-lucide="user" class="w-3 h-3"></i> Perfil
</button>
                    <button onclick="handleSignOut()" class="w-full text-left px-4 py-3 text-[10px] font-bold uppercase hover:bg-red-500/10 text-red-500 rounded-lg flex items-center gap-2">
                        <i data-lucide="log-out" class="w-3 h-3"></i> Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
    </div>
</nav>

<section class="pt-24 px-8 mb-16">
    <div id="hero-slider" class="max-w-[1440px] mx-auto relative h-[600px] rounded-[2.5rem] overflow-hidden group">
        <img id="hero-img" src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1600" class="w-full h-full object-cover transition-opacity duration-700">
        <div class="absolute inset-0 bg-gradient-to-r from-black via-black/40 to-transparent"></div>
        <div class="absolute bottom-16 left-16 animate__animated animate__fadeInLeft">
            <span class="bg-red-500 text-white text-[10px] font-black px-3 py-1 rounded-md mb-4 inline-block">New Release</span>
            <h1 id="hero-title" class="text-7xl font-black mb-2 leading-none uppercase">Shadow Realm<br>Chronicles</h1>
            <p id="hero-desc" class="text-cyan-400 font-bold mb-6">Darkness Falls</p>
            <button class="btn-buy px-10 py-4" data-key="btn-buy">Buy Now</button>
        </div>
    </div>
</section>

<section class="max-w-[1440px] mx-auto px-8 mb-24 reveal">
    <div class="text-center mb-12">
        <h2 class="text-3xl font-black uppercase italic mb-2" data-key="cat-title">Browse by Category</h2>
        <p class="text-gray-500 text-sm" data-key="cat-subtitle">Explore our vast collection of games across all genres</p>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="sword" class="w-6 h-6 mx-auto mb-3 text-orange-500"></i>
            <h4 class="text-[10px] font-bold uppercase">Action</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="rocket" class="w-6 h-6 mx-auto mb-3 text-blue-500"></i>
            <h4 class="text-[10px] font-bold uppercase">Adventure</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="car" class="w-6 h-6 mx-auto mb-3 text-green-500"></i>
            <h4 class="text-[10px] font-bold uppercase">Racing</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="puzzle" class="w-6 h-6 mx-auto mb-3 text-purple-500"></i>
            <h4 class="text-[10px] font-bold uppercase">Puzzle</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="users" class="w-6 h-6 mx-auto mb-3 text-yellow-500"></i>
            <h4 class="text-[10px] font-bold uppercase">Multiplayer</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="trophy" class="w-6 h-6 mx-auto mb-3 text-cyan-500"></i>
            <h4 class="text-[10px] font-bold uppercase">Sports</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="wand-2" class="w-6 h-6 mx-auto mb-3 text-indigo-500"></i>
            <h4 class="text-[10px] font-bold uppercase">RPG</h4>
        </div>
        <div class="cat-item bg-white/5 p-6 rounded-2xl border border-white/5 text-center cursor-pointer">
            <i data-lucide="ghost" class="w-6 h-6 mx-auto mb-3 text-gray-400"></i>
            <h4 class="text-[10px] font-bold uppercase">Horror</h4>
        </div>
    </div>
</section>

<section class="max-w-[1440px] mx-auto px-8 mb-24 reveal">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-black uppercase italic">Featured in VAULT</h2>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="vault-grid">
        <p class="text-gray-500 italic col-span-full py-10 text-center">Loading the Vault...</p>
    </div>
</section>

<section class="max-w-[1440px] mx-auto px-8 mb-24 reveal">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-black uppercase italic" data-key="news-title">Latest News</h2>
        <a href="news.html" class="text-cyan-400 text-xs font-bold flex items-center gap-2"><span data-key="news-btn">View All News</span> <i data-lucide="arrow-right" class="w-4 h-4"></i></a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="group cursor-pointer">
            <div class="h-40 rounded-2xl overflow-hidden mb-4 border border-white/5">
                <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=600" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
            </div>
            <span class="text-[#76ff03] text-[9px] font-bold">JAN 15, 2024</span>
            <h3 class="font-bold text-sm mt-1 leading-snug">GTA 6 Trailer Breaks All-Time Records with 100M Views</h3>
        </div>
        <div class="group cursor-pointer">
            <div class="h-40 rounded-2xl overflow-hidden mb-4 border border-white/5">
                <img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=600" class="w-full h-full object-cover group-hover:scale-110 transition-transform">
            </div>
            <span class="text-[#76ff03] text-[9px] font-bold">JAN 14, 2024</span>
            <h3 class="font-bold text-sm mt-1 leading-snug">New VR Tech Announced for Immersive Gaming</h3>
        </div>
    </div>
</section>

<section class="max-w-[1440px] mx-auto px-8 mb-24 reveal">
    <div class="bg-gradient-to-r from-[#0a1a0a] to-[#050505] p-12 rounded-[2rem] border border-[#76ff03]/20 flex flex-col md:flex-row items-center justify-between">
        <div>
            <h2 class="text-3xl font-black mb-2 uppercase italic" data-key="loop-title">Stay in the loop</h2>
            <p class="text-gray-400 text-sm" data-key="loop-subtitle">Get the latest deals, news and updates delivered to your inbox</p>
        </div>
        <div class="flex gap-4 w-full md:w-auto mt-6 md:mt-0">
            <input type="email" placeholder="Enter your email" class="bg-black/50 border border-white/10 px-6 py-4 rounded-xl text-sm outline-none focus:border-[#76ff03] w-full md:w-80">
            <button class="bg-cyan-400 text-black px-8 py-4 rounded-xl font-bold flex items-center gap-2 hover:scale-105 transition">
                <i data-lucide="mail" class="w-4 h-4"></i> <span data-key="loop-btn">Subscribe</span>
            </button>
        </div>
    </div>
</section>

<footer class="bg-[#020202] border-t border-white/5 pt-20 pb-10 px-8">
    <div class="max-w-[1440px] mx-auto">
        <div class="grid grid-cols-2 md:grid-cols-5 gap-12 mb-20">
            <div class="col-span-2 md:col-span-1">
                <div class="flex items-center gap-2 mb-6">
                    <div class="bg-[#76ff03] p-1.5 rounded-lg"><i data-lucide="shield" class="text-black w-5 h-5"></i></div>
                    <span class="text-xl font-black italic">VAULT</span>
                </div>
                <p class="text-gray-500 text-xs leading-relaxed" data-key="footer-desc">Your ultimate destination for PC gaming. Discover, play, and connect.</p>
            </div>
            <div>
                <h5 class="text-white font-bold text-sm mb-6 uppercase" data-key="f-col1-t">About</h5>
                <ul class="text-gray-500 text-xs space-y-4"><li>About Us</li><li>Careers</li></ul>
            </div>
            <div>
                <h5 class="text-white font-bold text-sm mb-6 uppercase" data-key="f-col2-t">Support</h5>
                <ul class="text-gray-500 text-xs space-y-4"><li>Help Center</li><li>Contact Us</li></ul>
            </div>
            <div>
                <h5 class="text-white font-bold text-sm mb-6 uppercase" data-key="f-col3-t">Legal</h5>
                <ul class="text-gray-500 text-xs space-y-4"><li>Terms</li><li>Privacy</li></ul>
            </div>
            <div>
                <h5 class="text-white font-bold text-sm mb-6 uppercase" data-key="f-col4-t">Devs</h5>
                <ul class="text-gray-500 text-xs space-y-4"><li>Publish</li><li>Partner Program</li></ul>
            </div>
        </div>
        <div class="flex flex-col md:flex-row justify-between items-center pt-10 border-t border-white/5 gap-6">
            <p class="text-[10px] text-gray-600">© 2024 VAULT. All rights reserved.</p>
            <div class="flex items-center gap-6 opacity-40 grayscale">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" class="h-2">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" class="h-4">
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" class="h-3">
            </div>
        </div>
    </div>
</footer>

<div id="auth-modal" class="fixed inset-0 z-[300] items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/95 backdrop-blur-xl" onclick="closeAuthModal()"></div>
    <div class="bg-[#0d0d0d] w-full max-w-md rounded-[2.5rem] border border-white/10 p-10 relative z-10">
        <h2 id="auth-title" class="text-3xl font-black uppercase italic mb-8">Sign In</h2>
        <div class="space-y-4">
            <input type="email" id="auth-email" placeholder="Email" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 text-sm outline-none focus:border-cyan-400">
            <input type="password" id="auth-pass" placeholder="Password" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 text-sm outline-none focus:border-cyan-400">
            <button onclick="handleAuth()" id="auth-submit-btn" class="w-full bg-cyan-400 text-black font-black py-4 rounded-xl uppercase text-xs tracking-widest mt-4">Sign In</button>
            <p class="text-center text-[10px] text-gray-500"><button onclick="switchAuthMode()" id="auth-switch-btn" class="text-cyan-400 font-bold">Create Account</button></p>
        </div>
    </div>
</div>

<div id="game-modal" class="fixed inset-0 z-[200] items-center justify-center p-4 sm:p-8">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" onclick="closeModal()"></div>
    <div class="bg-[#0d0d0d] w-full max-w-6xl max-h-[90vh] rounded-[3rem] border border-white/10 overflow-y-auto relative z-10">
        <div class="relative h-[450px]">
            <img id="modal-banner" src="" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-[#0d0d0d] via-transparent to-transparent"></div>
            <button onclick="closeModal()" class="absolute top-8 right-8 bg-black/50 p-3 rounded-full hover:bg-white/10 transition"><i data-lucide="x"></i></button>
            <div class="absolute bottom-12 left-12 right-12 flex justify-between items-end">
                <div><span id="modal-cat" class="bg-cyan-500 text-black text-[10px] font-black px-3 py-1 rounded-full uppercase mb-4 inline-block">Category</span><h2 id="modal-title" class="text-6xl font-black uppercase italic"></h2></div>
                <div class="text-right"><p class="text-3xl font-black text-[#76ff03] mb-4" id="modal-price"></p><button class="btn-buy px-12 py-4">ADD TO CART</button></div>
            </div>
        </div>
        <div class="p-16"><h4 class="text-cyan-400 font-bold uppercase tracking-widest text-xs mb-6">About this game</h4><p id="modal-desc" class="text-gray-400 leading-relaxed text-lg max-w-4xl"></p></div>
    </div>
</div>

<script>
    // CONFIG SUPABASE
    const SUPABASE_URL = 'https://ettjrnpfgbcgwflmgcjv.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_sIyzTHGZX1o4B39cjE7_Aw_WdZ2w5Px';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let isLoginMode = true;

    // --- NUEVA LÓGICA DE USUARIO ---
    async function checkUser() {
        const { data: { user } } = await _supabase.auth.getUser();
        const authBtn = document.getElementById('auth-btn');
        const userMenu = document.getElementById('user-menu');

        if (user) {
            const userName = user.email.split('@')[0].toUpperCase();
            authBtn.innerHTML = `<i data-lucide="user" class="w-3 h-3"></i> ${userName}`;
            authBtn.classList.replace('bg-[#00e5ff]', 'bg-white/10');
            authBtn.classList.add('text-white');
            lucide.createIcons();
        } else {
            authBtn.innerHTML = `Sign In`;
            authBtn.classList.add('bg-[#00e5ff]');
            authBtn.classList.remove('bg-white/10', 'text-white');
        }
    }

    async function handleAuthClick() {
        const { data: { user } } = await _supabase.auth.getUser();
        if (user) {
            // Si está logueado, abre/cierra el menú de perfil
            document.getElementById('user-menu').classList.toggle('active');
        } else {
            // Si no está logueado, abre el modal de login
            openAuthModal();
        }
    }

    async function handleSignOut() {
        await _supabase.auth.signOut();
        location.reload();
    }
    // ---------------------------------

    async function loadGames() {
        const { data: games, error } = await _supabase.from('games').select('*').eq('status', 'verified');
        const grid = document.getElementById('vault-grid');
        if (games && games.length > 0) {
            grid.innerHTML = '';
            games.forEach(game => {
                grid.innerHTML += `
                <div class="card-v rounded-[2rem] overflow-hidden cursor-pointer group" onclick="openGameModal('${game.id}')">
                    <div class="relative h-56 overflow-hidden">
                        <img src="${game.image_url}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute top-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1 rounded-full text-[9px] font-black text-cyan-400 uppercase">Vault Exclusive</div>
                    </div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-black text-xl uppercase italic leading-tight">${game.title}</h3>
                            <span class="text-[#76ff03] font-black text-xl">${game.price}€</span>
                        </div>
                        <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">${game.category}</p>
                    </div>
                </div>`;
            });
            lucide.createIcons();
        }
    }

    async function openGameModal(id) {
        const { data: game } = await _supabase.from('games').select('*').eq('id', id).single();
        if(game) {
            document.getElementById('modal-title').innerText = game.title;
            document.getElementById('modal-desc').innerText = game.description;
            document.getElementById('modal-price').innerText = game.price + '€';
            document.getElementById('modal-cat').innerText = game.category;
            document.getElementById('modal-banner').src = game.image_url;
            document.getElementById('game-modal').classList.add('active');
            document.body.classList.add('no-scroll');
        }
    }

    function closeModal() { document.getElementById('game-modal').classList.remove('active'); document.body.classList.remove('no-scroll'); }
    function openAuthModal() { document.getElementById('auth-modal').classList.add('active'); }
    function closeAuthModal() { document.getElementById('auth-modal').classList.remove('active'); }
    function toggleLang(id) { document.getElementById(id).classList.toggle('active'); }

    async function handleAuth() {
        const email = document.getElementById('auth-email').value;
        const password = document.getElementById('auth-pass').value;
        if(isLoginMode) {
            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if(error) alert(error.message); else location.reload();
        } else {
            const { error } = await _supabase.auth.signUp({ email, password });
            if(error) alert(error.message); else alert("Verify email!");
        }
    }

    function switchAuthMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "Sign In" : "Join Vault";
        document.getElementById('auth-submit-btn').innerText = isLoginMode ? "Sign In" : "Register";
    }

    const slides = [
        { img: "https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1600", title: "Shadow Realm<br>Chronicles", desc: "Darkness Falls" },
        { img: "https://images.unsplash.com/photo-1605899435973-ca2d1a8861cf?w=1600", title: "Neon<br>Overdrive", desc: "Future is Now" }
    ];
    let cur = 0;
    setInterval(() => {
        cur = (cur + 1) % slides.length;
        const img = document.getElementById('hero-img');
        if(img) {
            img.style.opacity = 0;
            setTimeout(() => {
                img.src = slides[cur].img;
                document.getElementById('hero-title').innerHTML = slides[cur].title;
                document.getElementById('hero-desc').innerText = slides[cur].desc;
                img.style.opacity = 1;
            }, 500);
        }
    }, 5000);

    function reveal() {
        document.querySelectorAll(".reveal").forEach(el => {
            if (el.getBoundingClientRect().top < window.innerHeight - 100) el.classList.add("active");
        });
    }

    window.addEventListener("scroll", reveal);
    window.addEventListener("load", () => {
        lucide.createIcons();
        loadGames();
        checkUser(); // Verifica el usuario al cargar
        setTimeout(() => { 
            const loader = document.getElementById("vault-loader");
            if(loader) {
                loader.style.opacity = "0"; 
                setTimeout(() => { loader.remove(); reveal(); }, 600); 
            }
        }, 2000);
    });

    // Cerrar menú si se hace clic fuera
    window.addEventListener('click', (e) => {
        if (!document.getElementById('user-wrapper').contains(e.target)) {
            document.getElementById('user-menu').classList.remove('active');
        }
    });
</script>
</body>
</html>
